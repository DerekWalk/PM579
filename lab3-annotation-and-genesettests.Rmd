---
title: "Lab 3 Annotation & Gene set tests"
author: "ks"
date: "5/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(genefilter)
library(limma)
```

Let's analyze the prostate cancer cell line data we've used in class. The treatments are:  

treatment 1: siNS, sip300, siCBP 

treatment 2:  0 hr,  16 hrs
     
All cells are treated with androgen at 0 hrs. The genes that change expression between 0 and 16 hours are genes that are regulated by androgen. These might vary based on the different treatments siNS (control), sip300, and siCBP. Let's compare average gene expression between 0 and 16 hrs.

### 1. Load the data and subset on siNS only.
```{r ReadData}
jbcdir=c("data/JBC 2012")
load(file.path(jbcdir,"jbcdat.rda"))
names(jbcdat)
```

Subset on siNS only.
```{r subsetData}
sel <- which(jbcdat$targets$treatments == "siNS")
sjbcdat <- NULL
sjbcdat$E <- jbcdat$E[,sel]
sjbcdat$targets <- jbcdat$targets[sel,]
sjbcdat$genes <- jbcdat$genes
```

Compare average gene expression at 16 hours with avg gene expression at 0 hours.

```{r modT}
design <- model.matrix(~factor(sjbcdat$targets$hour))

fit  <- limma::lmFit(sjbcdat$E,design)
efit <- limma::eBayes(fit)
```

```{r topt}
tt <- limma::topTable(efit,coef=2,n=8)
tt
```

```{r genenames}
sjbcdat$genes[rownames(tt),]$Symbol
```

Let's look at the number of probes/gene
```{r usymbols}
length(sjbcdat$genes$Symbol)
length(unique(sjbcdat$genes$Symbol))
length(table(sjbcdat$genes$Symbol))
ts <- table(sjbcdat$genes$Symbol)
table(ts)
```

Let's look at 2 probes that plot to the same gene
```{r dups}
which(is.element(as.character(sjbcdat$genes$Symbol),
      "PMEPA1"))
```


```{r pickgene}
pmepa1 <- sjbcdat$E[which(is.element(as.character(sjbcdat$gene$Symbol),
                    "PMEPA1")),]

#dim(pmepa1)

time16h <- ifelse(sjbcdat$targets$hour=="16hr",1,2)
pairs(t(pmepa1),col=c("sienna","tomato")[time16h],
     pch=c(15,16)[time16h])
```

levelplots create heatmaps without clustering.

```{r lattice}
dat=t(pmepa1)
rownames(dat)=NULL
lattice::levelplot(dat,xlab="",ylab="")
```

Coming soon....  using camera() for gene set enrichment test.

```{r sessioninfo}
sessionInfo()
```